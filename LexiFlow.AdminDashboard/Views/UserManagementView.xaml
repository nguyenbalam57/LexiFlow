<UserControl x:Class="LexiFlow.AdminDashboard.Views.UserManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- Status to Color Converter -->
        <Style x:Key="StatusIndicatorStyle" TargetType="Border">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Background" Value="Red"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsActive}" Value="True">
                    <Setter Property="Background" Value="Green"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Card Style -->
        <Style x:Key="UserCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource MaterialDesignCardBackground}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" Direction="270" Color="Gray" Opacity="0.3" ShadowDepth="3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Form Style -->
        <Style x:Key="FormFieldStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignTextBox}">
            <Setter Property="Margin" Value="0,8"/>
            <Setter Property="Height" Value="40"/>
        </Style>

        <Style x:Key="FormComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource MaterialDesignComboBox}">
            <Setter Property="Margin" Value="0,8"/>
            <Setter Property="Height" Value="40"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="16">
        <!-- Loading Overlay -->
        <Border Background="Black" Opacity="0.5" 
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}" 
                           Value="0" IsIndeterminate="True" Width="50" Height="50"/>
                <TextBlock Text="Loading Users..." Foreground="White" 
                         FontSize="16" Margin="0,16,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Border>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*" MinWidth="400"/>
            </Grid.ColumnDefinitions>

            <!-- Main User List Section -->
            <Border Grid.Column="0" Style="{StaticResource UserCardStyle}" Margin="0,0,8,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Grid Grid.Row="0" Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="User Management" FontSize="24" FontWeight="Bold"/>
                            <TextBlock Text="Manage system users, roles, and permissions" 
                                     FontSize="14" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <Button Style="{StaticResource MaterialDesignRaisedButton}" 
                                    Command="{Binding CreateUserCommand}"
                                    Background="{DynamicResource PrimaryHueMidBrush}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="AccountPlus" Margin="0,0,4,0"/>
                                    <TextBlock Text="Add User"/>
                                </StackPanel>
                            </Button>
                            
                            <Button Style="{StaticResource MaterialDesignOutlinedButton}" 
                                    Command="{Binding ImportUsersCommand}"
                                    Margin="8,0,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Upload" Margin="0,0,4,0"/>
                                    <TextBlock Text="Import"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource MaterialDesignOutlinedButton}" 
                                    Command="{Binding ExportUsersCommand}"
                                    Margin="8,0,0,0">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Download" Margin="0,0,4,0"/>
                                    <TextBlock Text="Export"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- Search and Filters -->
                    <Grid Grid.Row="1" Margin="0,0,0,16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Search Bar -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0" 
                                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Search users..."
                                     Style="{StaticResource MaterialDesignTextBox}">
                                <TextBox.InputBindings>
                                    <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                                </TextBox.InputBindings>
                            </TextBox>

                            <Button Grid.Column="1" Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding SearchCommand}" Margin="8,0">
                                <materialDesign:PackIcon Kind="Magnify"/>
                            </Button>

                            <Button Grid.Column="2" Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding RefreshCommand}">
                                <materialDesign:PackIcon Kind="Refresh"/>
                            </Button>
                        </Grid>

                        <!-- Filter Row -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,0">
                            <ComboBox MinWidth="120" Margin="0,0,8,0"
                                      materialDesign:HintAssist.Hint="Status"
                                      SelectedValue="{Binding FilterIsActive}">
                                <ComboBoxItem Content="All" Tag="{x:Null}"/>
                                <ComboBoxItem Content="Active" Tag="True"/>
                                <ComboBoxItem Content="Inactive" Tag="False"/>
                            </ComboBox>

                            <ComboBox MinWidth="150" Margin="0,0,8,0"
                                      materialDesign:HintAssist.Hint="Role"
                                      ItemsSource="{Binding AllRoles}"
                                      DisplayMemberPath="RoleName"
                                      SelectedValuePath="RoleId">
                            </ComboBox>

                            <DatePicker Margin="0,0,8,0"
                                        materialDesign:HintAssist.Hint="Created From"
                                        SelectedDate="{Binding FilterCreatedFrom}"/>

                            <DatePicker Margin="0,0,8,0"
                                        materialDesign:HintAssist.Hint="Created To"
                                        SelectedDate="{Binding FilterCreatedTo}"/>

                            <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Command="{Binding ClearFiltersCommand}">
                                Clear Filters
                            </Button>
                        </StackPanel>
                    </Grid>

                    <!-- User DataGrid -->
                    <DataGrid Grid.Row="2" 
                              ItemsSource="{Binding Users}"
                              SelectedItem="{Binding SelectedUser}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              SelectionMode="Extended"
                              materialDesign:DataGridAssist.CellPadding="8,4"
                              materialDesign:DataGridAssist.ColumnHeaderPadding="8,4">
                        
                        <DataGrid.Columns>
                            <!-- Status Indicator -->
                            <DataGridTemplateColumn Header="" Width="40">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource StatusIndicatorStyle}"
                                                ToolTip="{Binding IsActive, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Username -->
                            <DataGridTextColumn Header="Username" 
                                                Binding="{Binding Username}" 
                                                Width="150"/>

                            <!-- Full Name -->
                            <DataGridTemplateColumn Header="Full Name" Width="200">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <TextBlock.Text>
                                                <MultiBinding StringFormat="{}{0} {1}">
                                                    <Binding Path="UserProfile.FirstName"/>
                                                    <Binding Path="UserProfile.LastName"/>
                                                </MultiBinding>
                                            </TextBlock.Text>
                                        </TextBlock>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Email -->
                            <DataGridTextColumn Header="Email" 
                                                Binding="{Binding Email}" 
                                                Width="200"/>

                            <!-- Roles -->
                            <DataGridTemplateColumn Header="Roles" Width="150">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <ItemsControl ItemsSource="{Binding UserRoles}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="{DynamicResource PrimaryHueLightBrush}"
                                                            CornerRadius="2" Padding="4,2" Margin="2">
                                                        <TextBlock Text="{Binding Role.RoleName}" 
                                                                   FontSize="10" Foreground="White"/>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                            <ItemsControl.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <WrapPanel/>
                                                </ItemsPanelTemplate>
                                            </ItemsControl.ItemsPanel>
                                        </ItemsControl>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Created Date -->
                            <DataGridTextColumn Header="Created" 
                                                Binding="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd}'}" 
                                                Width="100"/>

                            <!-- Actions -->
                            <DataGridTemplateColumn Header="Actions" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.EditUserCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Edit User">
                                                <materialDesign:PackIcon Kind="Edit" Width="16" Height="16"/>
                                            </Button>
                                            
                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.ManageUserRolesCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Manage Roles">
                                                <materialDesign:PackIcon Kind="AccountKey" Width="16" Height="16"/>
                                            </Button>

                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.ResetPasswordCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Reset Password">
                                                <materialDesign:PackIcon Kind="Key" Width="16" Height="16"/>
                                            </Button>

                                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                                    Command="{Binding DataContext.DeleteUserCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    ToolTip="Delete User">
                                                <materialDesign:PackIcon Kind="Delete" Width="16" Height="16"/>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Bulk Actions -->
                    <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,16,0,0"
                                Visibility="{Binding IsMultipleUsersSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="{Binding SelectedUsersCount, StringFormat='{}{0} users selected'}" 
                                   VerticalAlignment="Center" Margin="0,0,16,0"/>

                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                Command="{Binding ActivateSelectedUsersCommand}" Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="AccountCheck" Margin="0,0,4,0" Width="16" Height="16"/>
                                <TextBlock Text="Activate"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                Command="{Binding DeactivateSelectedUsersCommand}" Margin="0,0,8,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="AccountCancel" Margin="0,0,4,0" Width="16" Height="16"/>
                                <TextBlock Text="Deactivate"/>
                            </StackPanel>
                        </Button>

                        <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                Command="{Binding DeleteSelectedUsersCommand}" 
                                Background="{DynamicResource ValidationErrorBrush}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Delete" Margin="0,0,4,0" Width="16" Height="16"/>
                                <TextBlock Text="Delete Selected"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Pagination -->
                    <Grid Grid.Row="4" Margin="0,16,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" VerticalAlignment="Center"
                                   Text="{Binding StatusMessage}"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <TextBlock Text="{Binding TotalUsers, StringFormat='Total: {0} users'}" 
                                       VerticalAlignment="Center" Margin="0,0,16,0"/>

                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding FirstPageCommand}">
                                <materialDesign:PackIcon Kind="PageFirst"/>
                            </Button>

                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding PreviousPageCommand}">
                                <materialDesign:PackIcon Kind="ChevronLeft"/>
                            </Button>

                            <TextBlock Text="{Binding CurrentPage, StringFormat='Page {0}'}" 
                                       VerticalAlignment="Center" Margin="8,0"/>

                            <TextBlock Text="{Binding TotalPages, StringFormat='of {0}'}" 
                                       VerticalAlignment="Center" Margin="0,0,8,0"/>

                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding NextPageCommand}">
                                <materialDesign:PackIcon Kind="ChevronRight"/>
                            </Button>

                            <Button Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding LastPageCommand}">
                                <materialDesign:PackIcon Kind="PageLast"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Border>

            <!-- User Details/Edit Panel -->
            <Border Grid.Column="1" Style="{StaticResource UserCardStyle}" Margin="8,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Panel Header -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" 
                                       Text="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}"
                                       FontSize="20" FontWeight="SemiBold"/>

                            <Button Grid.Column="1" Style="{StaticResource MaterialDesignIconButton}"
                                    Command="{Binding CancelEditCommand}"
                                    Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}">
                                <materialDesign:PackIcon Kind="Close"/>
                            </Button>
                        </Grid>

                        <!-- User Form -->
                        <StackPanel Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}">
                            <!-- Basic Information -->
                            <TextBlock Text="Basic Information" FontSize="16" FontWeight="Medium" Margin="0,0,0,8"/>

                            <TextBox Text="{Binding FormUsername, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Username"
                                     Style="{StaticResource FormFieldStyle}"/>

                            <TextBox Text="{Binding FormEmail, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Email"
                                     Style="{StaticResource FormFieldStyle}"/>

                            <PasswordBox x:Name="PasswordBox"
                                         materialDesign:HintAssist.Hint="Password"
                                         Style="{StaticResource MaterialDesignPasswordBox}"
                                         Margin="0,8"
                                         Height="40"
                                         Visibility="{Binding IsEditMode, Converter={StaticResource BoolToVisibilityConverter}}"/>

                            <!-- Personal Information -->
                            <TextBlock Text="Personal Information" FontSize="16" FontWeight="Medium" Margin="0,16,0,8"/>

                            <TextBox Text="{Binding FormFirstName, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="First Name"
                                     Style="{StaticResource FormFieldStyle}"/>

                            <TextBox Text="{Binding FormLastName, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Last Name"
                                     Style="{StaticResource FormFieldStyle}"/>

                            <TextBox Text="{Binding FormPhoneNumber, UpdateSourceTrigger=PropertyChanged}"
                                     materialDesign:HintAssist.Hint="Phone Number"
                                     Style="{StaticResource FormFieldStyle}"/>

                            <!-- Preferences -->
                            <TextBlock Text="Preferences" FontSize="16" FontWeight="Medium" Margin="0,16,0,8"/>

                            <ComboBox SelectedValue="{Binding FormPreferredLanguage}"
                                      materialDesign:HintAssist.Hint="Preferred Language"
                                      Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="English" Tag="en"/>
                                <ComboBoxItem Content="Japanese" Tag="ja"/>
                                <ComboBoxItem Content="Vietnamese" Tag="vi"/>
                            </ComboBox>

                            <ComboBox SelectedValue="{Binding FormTimeZone}"
                                      materialDesign:HintAssist.Hint="Time Zone"
                                      Style="{StaticResource FormComboBoxStyle}">
                                <ComboBoxItem Content="UTC" Tag="UTC"/>
                                <ComboBoxItem Content="Asia/Tokyo" Tag="Asia/Tokyo"/>
                                <ComboBoxItem Content="Asia/Ho_Chi_Minh" Tag="Asia/Ho_Chi_Minh"/>
                            </ComboBox>

                            <!-- Roles -->
                            <TextBlock Text="Roles" FontSize="16" FontWeight="Medium" Margin="0,16,0,8"/>

                            <ListBox ItemsSource="{Binding AllRoles}"
                                     SelectionMode="Multiple"
                                     MaxHeight="150"
                                     Style="{StaticResource MaterialDesignListBox}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox Content="{Binding RoleName}"
                                                  IsChecked="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <!-- Status -->
                            <CheckBox IsChecked="{Binding FormIsActive}"
                                      Content="User is active"
                                      Margin="0,16,0,0"/>

                            <!-- Action Buttons -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,24,0,0">
                                <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding CancelEditCommand}"
                                        Margin="0,0,8,0">
                                    Cancel
                                </Button>

                                <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                        Command="{Binding SaveUserCommand}"
                                        Background="{DynamicResource PrimaryHueMidBrush}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="ContentSave" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding IsEditMode, StringFormat='{}{0}'}"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>

                        <!-- User Details View (when not editing) -->
                        <StackPanel Visibility="{Binding IsUserSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="User Details" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,16"/>

                            <!-- User Info Display -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Username:" FontWeight="Medium" Margin="0,4,16,4"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedUser.Username}" Margin="0,4"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Email:" FontWeight="Medium" Margin="0,4,16,4"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding SelectedUser.Email}" Margin="0,4"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Full Name:" FontWeight="Medium" Margin="0,4,16,4"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" Margin="0,4">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0} {1}">
                                            <Binding Path="SelectedUser.UserProfile.FirstName"/>
                                            <Binding Path="SelectedUser.UserProfile.LastName"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Phone:" FontWeight="Medium" Margin="0,4,16,4"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SelectedUser.UserProfile.PhoneNumber}" Margin="0,4"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Language:" FontWeight="Medium" Margin="0,4,16,4"/>
                                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding SelectedUser.PreferredLanguage}" Margin="0,4"/>

                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Created:" FontWeight="Medium" Margin="0,4,16,4"/>
                                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding SelectedUser.CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Margin="0,4"/>
                            </Grid>

                            <!-- User Roles -->
                            <TextBlock Text="Assigned Roles" FontSize="16" FontWeight="Medium" Margin="0,16,0,8"/>
                            <ItemsControl ItemsSource="{Binding SelectedUser.UserRoles}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource PrimaryHueLightBrush}"
                                                CornerRadius="4" Padding="8,4" Margin="2">
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="AccountKey" Width="16" Height="16" 
                                                                       Foreground="White" VerticalAlignment="Center"/>
                                                <TextBlock Text="{Binding Role.RoleName}" 
                                                           Foreground="White" Margin="4,0,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>

                            <!-- Action Buttons -->
                            <StackPanel Margin="0,24,0,0">
                                <Button Style="{StaticResource MaterialDesignRaisedButton}"
                                        Command="{Binding EditUserCommand}"
                                        Margin="0,4"
                                        Background="{DynamicResource PrimaryHueMidBrush}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Edit" Margin="0,0,4,0"/>
                                        <TextBlock Text="Edit User"/>
                                    </StackPanel>
                                </Button>

                                <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding ManageUserRolesCommand}"
                                        Margin="0,4">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="AccountKey" Margin="0,0,4,0"/>
                                        <TextBlock Text="Manage Roles"/>
                                    </StackPanel>
                                </Button>

                                <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding ResetPasswordCommand}"
                                        Margin="0,4">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Key" Margin="0,0,4,0"/>
                                        <TextBlock Text="Reset Password"/>
                                    </StackPanel>
                                </Button>

                                <Button Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Command="{Binding DeleteUserCommand}"
                                        Margin="0,4"
                                        Background="{DynamicResource ValidationErrorBrush}"
                                        BorderBrush="{DynamicResource ValidationErrorBrush}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Delete" Margin="0,0,4,0"/>
                                        <TextBlock Text="Delete User"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>

                        <!-- Empty State -->
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                                    Visibility="{Binding IsUserSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                            <materialDesign:PackIcon Kind="AccountOutline" Width="48" Height="48" 
                                                   Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="Select a user to view details" 
                                       FontSize="16" Foreground="{DynamicResource MaterialDesignBodyLight}"
                                       HorizontalAlignment="Center" Margin="0,8,0,0"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</UserControl>